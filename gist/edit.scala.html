@(gist: Option[Map[String, String]], files: Seq[(String, util.JGitUtil.ContentInfo)])(implicit context: app.Context)
@import context._
@import view.helpers._
<div class="container">
  @if(gist.isEmpty){
    <div class="head">
      New snippet
    </div>
  } else {
    @gist.map { x =>
      <div class="head">
        Editing
        <a href="@path/gist/@x("USER_NAME")">@x("USER_NAME")</a> /
        <a href="@path/gist/@x("USER_NAME")/@x("REPOSITORY_NAME")">@x("TITLE")</a>
        <div class="pull-right">
          <a href="@path/gist/@x("USER_NAME")/@x("REPOSITORY_NAME")/secret" class="btn">Make secret</a>
          <a href="@path/gist/@x("USER_NAME")/@x("REPOSITORY_NAME")/delete" class="btn" id="delete">Delete</a>
        </div>
      </div>
      <div class="muted">
        Created at @x("REGISTERED_DATE")
      </div>
    }
  }
</div>
<hr style="margin-bottom: 20px;"/>
<div class="container">
    <form id="form" method="POST" action="#">
      <input type="text" name="description" id="description" style="width: 900px;" value="@gist.map(_("DESCRIPTION"))" placeholder="Snippet descriptions..."/>
      <div id="editors">
        @files.zipWithIndex.map { case ((fileName, content), i) =>
          @editor(i, fileName, content)
        }
      </div>
      <div>
        <input type="button" value="Add file" class="btn" id="add_file">
        <div class="pull-right">
            @gist.map { x =>
              <a href="@path/gist/@x("USER_NAME")/@x("REPOSITORY_NAME")" class="btn">Cancel</a>
              <input type="submit" value="Update" class="btn btn-success submit_snippet" id="update_snippet">
            }.getOrElse {
              <input type="submit" value="Create private Snippet" class="btn submit_snippet" id="create_private_snippet">
              <input type="submit" value="Create public Snippet" class="btn submit_snippet" id="create_public_snippet">
            }
        </div>
      </div>
      @if(gist.isEmpty){
        <input type="hidden" id="private" name="private" value="false"/>
      }
      <input type="hidden" id="count" name="count" value="@files.size"/>
    </form>
</div>

<script src="@assets/vendors/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="@assets/vendors/jsdifflib/difflib.js"></script>
<script type="text/javascript" src="@assets/vendors/jsdifflib/diffview.js"></script>
<link href="@assets/vendors/jsdifflib/diffview.css" type="text/css" rel="stylesheet" />
<script>
$(function(){
  $('#create_private_snippet').click(function(){
    $('#form').attr('action', '@path/gist/_new')
    $('#private').val('true');
  });

  $('#create_public_snippet').click(function(){
    $('#form').attr('action', '@path/gist/_new')
    $('#private').val('false');
  });

  $('#add_file').click(function(){
    var count = $('#count').val();
    $.get('@path/gist/_add?count=' + count, function(html){
      $('#editors').append(html);
      $('#count').val(count + 1);
    });
  });

  $('#update_snippet').click(function(){
    @gist.map { x =>
      $('#form').attr('action', '@path/gist/@x("USER_NAME")/@x("REPOSITORY_NAME")/edit')
    }
  });

  $('.submit_snippet').click(function(){
    @files.zipWithIndex.map { case ((fileName, content), i) =>
      var editor = ace.edit('editor-@i');
      $('#content-@i').val(editor.getValue());
    }
  });

  $('#delete').click(function(){
    return confirm('Are you positive you want to delete this Gist?');
  });
});
</script>
